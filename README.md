# Weather-Sensitive Sales Modeling for Forecast NOW Hackathon

**Forecast NOW!** — программа для автозаказа, оптимизации запасов и прогнозирования спроса. Специализируется на одном продукте, что позволяет глубоко исследовать и совершенствовать методы управления запасами и моделирования спроса.

---

## Цель проекта

Разработать модель, которая оценивает влияние погодных условий (температура, осадки) на продажи товаров в конкретных локациях. В результате для каждого товара формируется система коэффициентов, корректирующих прогноз спроса в зависимости от прогноза погоды на предстоящие периоды.

## Данные

* **train.csv** — исторические продажи (`date`, `store_nbr`, `item_nbr`, `units`).
* **weather.csv** — погодные данные по станциям (`tmax`, `tmin`, `tavg`, `preciptotal`, и др.).
* **key.csv** — соответствие `store_nbr` ↔ `station_nbr`.
* **test.csv** — данные для прогнозирования.

---

## Основные этапы работы

### 1. Обработка пропущенных значений

* Замена специальных меток (M, T, -) на NaN в ключевых погодных столбцах.

* One-hot encoding для погодных кодов из codesum.

* Объединение таблиц продаж, погодных данных и координат магазинов.

* Преобразование признаков к числовому типу и проверка на выбросы через boxplot.

* Удаление крайних выбросов по перцентилям (1%–99%) для всех погодных и целевой переменных.

* Заполнение оставшихся пропусков station-wise средним значением по станции.

### 2. Feature Engineering

* Декодирование погодных условий: one-hot признаки из codesum.

* Временные признаки: год, месяц, день, сезон (winter/spring/summer/fall).

* Булевы флаги: weekend (1 для сб/вс), holidays (1 для официальных праздников США).

* Географические признаки: координаты магазинов (latitude, longitude).

* Признак sale (1 если units > 0, иначе 0).

### 3. EDA

* Boxplots для числовых погодных признаков и оценки распределений.

* Корреляционная тепловая карта между всеми числовыми переменными (погода, продажи, идентификаторы).

* Анализ распределения продаж по `item_nbr` и `store_nbr` с помощью countplot.

* Сводная таблица (`pivot_table`) суммарных продаж по сочетанию магазина и товара.

* Тест Дики-Фуллера для проверки стационарности ряда `tmax`, визуализация скользящего среднего и стандартного отклонения.

### 4. Моделирование

* **Классификация** (`sale`):

  * Разделение на train/test, обучение RandomForestClassifier для оценки feature importance.

  * LogisticRegression с RandomizedSearchCV (F1-скор, ROC-AUC) для предсказания факта продажи.

  * ROC-кривая и метрики качества на train и test.

* **Регрессия** (`units` при `sale==1`):

  * Отбор записей с `sale==1` и разделение на train/test.

  * RandomizedSearchCV для моделей SVM (SVR), RandomForestRegressor и LGBMRegressor.

  * Оценка по RMSE, вывод метрик и построение feature importance для лучшей регрессионной модели.

### 5. Интерпретация коэффициентов

* Анализ важности признаков (feature_importances_) для классификации и регрессии.

* Выделение ключевых погодных и временных факторов, влияющих на вероятность и объём продаж.

* Вычисление коэффициентов регрессионных моделей позволяет корректировать прогноз заказа товаров в зависимости от прогноза погоды.

---

## Навыки

* Статистика и методы регрессии
* Работа с временными рядами (Pandas)
* Инженерия признаков и агрегирование по временным/географическим данным
* Python (scikit‑learn, statsmodels) и визуализация (Matplotlib, Seaborn, Plotly)

## Критерии оценивания

1. **Точность и адекватность** модели: качество прогноза при учёте погоды.
2. **Гибкость**: возможность применения в разных регионах/товарах/периодах.
3. **Интерпретируемость**: понятные коэффициенты и отчёты.
4. **Визуализация**: наглядные графики и дашборды.
5. **Качество кода и документации**: чистота, структурированность, комментарии.

---

## Структура репозитория

```
├── data/                  # Датасеты
│   ├── train.csv
│   ├── test.csv
│   ├── weather.csv
│   ├── key.csv
│   └── store_city_coordinates
├── notebooks/             # Jupyter-ноутбуки
│   └── modeling.ipynb
├── README.md              # Этот файл
└── requirements.txt       # Зависимости проекта
```

---

## Команда проекта

|               | Участник             | Роли и задачи                                |
| ------------  | -------------------  | -------------------------------------------- |
| Teamlead      | Константин Агапов    | ML Engineering                               |
| ML Engineer   | Сергей Зинкин        | EDA, ML Engineering                          |
| ML Engineer   | Маргарита Баландина  | EDA, Data Proprocessing, ML Engineering      |
| Data Analyst  | Фадеичев Даниил      | EDA, Data Proprocessin                       |
| Data Analyst  | Лаврухина Виктория   | EDA, Data Proprocessing                      |

---

**Начало работы:**

```bash
git clone git@github.com:LavrukhinaV/hackathon-forecast-now.git
cd hackathon-forecast-now
```

Открыть ноутбук в `notebooks/` и следовать порядку выполнения.

---

